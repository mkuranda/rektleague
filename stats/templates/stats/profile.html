{% extends "stats/base.html" %}
{% load staticfiles %}

{% block title %} Rekt League | Profile {% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'stats/css/profile.css' %}">
<script type="text/javascript"><!--
function unHideUsernameForm()
{
	document.getElementById("usernameForm").style.display = "block";
	document.getElementById("unHideUsernameButton").style.display = "none";
}
function unHidePasswordForm()
{
	document.getElementById("passwordForm").style.display = "block";
	document.getElementById("unHidePasswordButton").style.display = "none";
}
function unHideEmailForm()
{
	document.getElementById("emailForm").style.display = "block";
	document.getElementById("unHideEmailButton").style.display = "none";
}

{% for account in accounts %}
function unHideAccountForm{{ account.id }}()
{
	document.getElementById("accountForm{{ account.id }}").style.display = "block";
	document.getElementById("editButton{{ account.id }}").style.display = "none";
}
{% endfor %}
function unHideAddAccount()
{
	document.getElementById("addAccountForm").style.display = "block";
	document.getElementById("unhideAddAccountButton").style.display = "none";
}
</script>

{% endblock %}

{% block content %}

{% if user.is_authenticated %}

{{ usernameForm.username.errors }}
{{ passwordForm.password1.errors }}
{{ emailForm.email.errors }}
{{ editForms.0.account_name.errors }}
{{ addAccountForm.account_name.errors.0 }}

<section class="profileHeader">
  <img class="playerPhoto" src="/media/stats/player_photos/audulma.png">
  <h2>Audulma</h2>
  <h3>SCUTTLE CRAB</h3>
</section>

<div class="tab">
  <button class="tablinks" onclick="openCity(event, 'profileTab')" id="defaultOpen">PROFILE</button>
  <button class="tablinks" onclick="openCity(event, 'seasonTab')">MY SEASON</button>
  <button class="tablinks" onclick="openCity(event, 'accountTab')">ACCOUNT</button>
</div>

<div id="profileTab" class="tabcontent">
  <div class="profileContainerAccount">
  <h4>ACCOUNTS</h4>  
  {% for account, removeForm, editForm, setMainForm in accountForms %}
  <h1 style="color: white">{{ account.name }}{% if account.isMain %}<i class="fas fa-crown"></i>{% endif %}</h1>
  <div class="playerActionsBar">
    <i id="editButton{{ account.id }}" onclick="unHideAccountForm{{ account.id }}()" class="fas fa-user-edit editButton"></i>
    <i id="removeButton" class="fas fa-user-minus"></i>
    <i id="setMainButton" class="fas fa-chevron-up"></i>
  </div>
  {% if not account.isMain %} 
  <form id="removeAccountForm" method="POST" class="form-group">
    {% csrf_token %}
      <div style="display: none">
        {{ removeForm.account_id }}
      </div>
  <!-- <i id="myBtn" class="fas fa-user-minus"></i> -->
  </form>
  <form id="setMainForm" method="POST" class="form-group">
    {% csrf_token %}
      <div style="display: none">
        {{ setMainForm.account_id }}
      </div>
      <button class="btn btn-primary spacer" name="submitSetMain{{ account.id }}" type="submit">Set Main</button>
  </form>
  {% endif %}
  
  <div id="accountForm{{ account.id }}" style="display: none">
  <form id="editAccountForm" method="POST" class="form-group">
    {% csrf_token %}
      <div class="form-group spacer">
        <label for="account_name">Account Name</label>
        {{ editForm.account_name }}
      </div>
      <div style="display: none">
        {{ editForm.account_id }}
      </div>
      <button class="btn btn-primary spacer" name="submitEdit{{ account.id }}" type="submit">Save</button>
  </form>
  
  </div>
  {% endfor %}
  
  <div id="unhideAddAccountButton">
    <i id="addButton" class="fas fa-user-plus" onclick="unHideAddAccount()"></i>
  </div>
  
  <form id="addAccountForm" method="POST" class="form-group" style="display: none">
    {% csrf_token %}
      <div class="form-group spacer">
        <label for="account_name">Account Name</label>
        {{ addAccountForm.account_name }}
      </div>
      <button class="btn btn-primary spacer" name="submitAdd" type="submit">Add Account</button>
  </form>
  <div style="color: white">
  {% for invite in invites %}
  <p>You are invited to join <a href="/stats/season/{{ invite.team.season.id }}/team/{{ invite.team.id }}/">SEASON {{ invite.team.season.id }} {{ invite.team.media.name }}</a> ({{ invite.role.name }}) <a href="/join-team/{{ invite.team.id }}/">Accept</a></p>
  {% endfor %}
  
  {% for team in teams %}
  {% if team.season.isActive %}
  <p>You are a member of <a href="/stats/season/{{ team.season.id }}/team/{{ team.id }}/">{{ team.media.name }} - {{ team.season }}</a> <a href="/leave-team/{{ team.id }}/">Leave Team</a></p>
  {% endif %}
  {% endfor %}
  </div>
<!-- END Profile account container  -->
</div>

<div class="profileContainerAlerts">
  <h4>ALERTS</h4>  
  <div class="alertContainer">
    <div class="redAccent"></div>
    <p>You have been invited to play for Infernal as a Top laner. <strong>Accept this offer?</strong></p>
    <div class="alertConfirm"><i class="fas fa-check"></i></div>
    <div class="alertDeny"><i class="fas fa-times"></i></div>
  </div>
</div>

<div class="profileContainerAlerts">
  <div class="alertContainer">
    <div class="redAccent"></div>
    <p class="alertMessage">You haven't signed up for Season 7!</p>
    <div class="alertClose"><i class="fas fa-times"></i></div>
  </div>
</div>

  <!-- END PROFILE TAB -->
</div>
<div id="seasonTab" class="tabcontent">
  <div class="seasonContainerAlerts">
    <h4>SEASON 7 NOTIFICATIONS</h4>  
    <div class="alertContainer">
      <div class="redAccent"></div>
      <p>You have been invited to play for Infernal as a Top laner. <strong>Accept this offer?</strong></p>
      <div class="alertConfirm"><i class="fas fa-check"></i></div>
      <div class="alertDeny"><i class="fas fa-times"></i></div>
    </div>

    <div class="alertContainer">
      <div class="redAccent"></div>
      <p class="alertMessage">You haven't signed up for Season 7!</p>
      <div class="alertClose"><i class="fas fa-times"></i></div>
    </div>
  </div>
  

  <div class="seasonContainerInfo">
    <h4>MY TEAM</h4> 
    <p>You are currently the Top laner for Scuttle Crab! For more information click here.</p>
    <button class="btn btn-primary spacer">SCUTTLE</button>
    <h4>MY SIGN UP</h4>
    <p>You are currently signed up as a BAD JUNGLER. Need to do a role swap? Resubmit your sign up here.</p>
    <button class="btn btn-primary spacer">RESUBMIT</button>

    <p>Don't want to play in Season 7? Delete your sign up here.</p>
    <button class="btn btn-primary spacer">DELETE SIGN UP</button>
  </div>
  <!-- MATT TOGGLE BETWEEN THESE TWO SECTIONS -->
  <div class="seasonContainerInfo">
    <h4>SIGN UP</h4> 
    <p>You are not signed up for Season 7. Don't be a square, get in there!</p>
    <button class="btn btn-primary spacer">SIGN UP</button>
  </div>

</div>

<!-- END Season TAB -->

<div id="accountTab" class="tabcontent">
  <h4>ACCOUNT NAME</h4> 
  <h1 style="color: white">{{ user.username }}</h1>
  <button id="editAccountNameButton" class="btn btn-primary spacer" id="editUsername" onclick="unHideUsernameForm()">Edit</button>
  <div id="usernameForm" style="display: none">
  <form id="editUsernameForm" method="POST" class="form-group">
    {% csrf_token %}
      <div class="form-group spacer">
        <label for="username">New Username</label>
        {{ usernameForm.username }}
      </div>
      <button class="btn btn-primary spacer" name="submitUsername" type="submit">Save</button>
  </form>

  </div>
  <h4>PASSWORD</h4> 
  <button id="editPasswordButton" class="btn btn-primary spacer" id="editEmail" onclick="unHidePasswordForm()">Change Password</button>
  <div id="passwordForm" style="display: none">
  <form id="editPasswordForm" method="POST" class="form-group">
    {% csrf_token %}
      <div class="form-group spacer">
        <label for="password">New Password</label>
        {{ passwordForm.password1 }}
      </div>
      <div class="form-group spacer">
        <label for="password2">Confirm Password</label>
        {{ passwordForm.password2 }}
      </div>

      <button class="btn btn-primary spacer" name="submitPassword" type="submit">Save</button>
  </form>
  </div>
  <h4>EMAIL</h4> 
  <h1 style="color: white">{{ user.email }}</h1>
  <button id="editEmailButton" class="btn btn-primary spacer" id="editEmail" onclick="unHideEmailForm()">Edit</button>
  <div id="emailForm" style="display: none">
  <form id="editEmailForm" method="POST" class="form-group">
    {% csrf_token %}
      <div class="form-group spacer">
        <label for="email">New Email</label>
        {{ emailForm.email }}
      </div>
      <button class="btn btn-primary spacer" name="submitEmail" type="submit">Save</button>
  </form>
  </div>

  <!-- END ACCOUNT TAB -->
</div>

<!-- START MODALS -->

<!-- REMOVE PLAYER MODAL -->
<div class="modal fade" id="removeModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="padding:10px 50px;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          
        </div>
        <div class="modal-body" style="padding:15px 50px;">
          <p>Are you sure you want to remove this account?</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

            <button class="btn btn-primary spacer" name="submitRemove{{ account.id }}" type="submit" data-dismiss="modal">Remove
              </button>
              
        </div>
      </div>
      
    </div>
  </div> 
</div>

<!-- EDIT PLAYER MODAL -->
<div class="modal fade" id="editModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        <form id="editAccountForm" method="POST" class="form-group">
          {% csrf_token %}
            <div class="form-group spacer">
              <label for="account_name">Account Name</label>
              {{ editForm.account_name }}
            </div>
            <div style="display: none">
              {{ editForm.account_id }}
            </div>
            
        </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <button class="btn btn-primary spacer" name="submitEdit{{ account.id }}" type="submit">Save</button>
            
      </div>
    </div>
    
  </div>
</div> 
</div>

<!-- SET MAIN PLAYER MODAL -->
<div class="modal fade" id="setMainModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        <p>Set this account as your main account?</p>
      </div>
      <div class="modal-footer">
        <div class="editModalButtonSection">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <form id="setMainForm" method="POST" class="form-group">
            {% csrf_token %}
              <div style="display: none">
                {{ setMainForm.account_id }}
              </div>
              <button class="btn btn-primary spacer" name="submitSetMain{{ account.id }}" type="submit">Set Main</button>
          </form>
        </div>
      </div>
    </div>
    
  </div>
</div> 
</div>

<!-- ADD PLAYER MODAL -->
<div class="modal fade" id="addModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        Add Account filler
        <form id="addAccountForm" method="POST" class="form-group" style="display: none">
          {% csrf_token %}
            <div class="form-group spacer">
              <label for="account_name">Account Name</label>
              {{ addAccountForm.account_name }}
            </div>
        </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <button class="btn btn-primary spacer" name="submitAdd" type="submit">Add Account</button>
            
      </div>
    </div>
    
  </div>
</div> 
</div>

<!-- EDIT ACCOUNT NAME MODAL -->
<div class="modal fade" id="editAccountNameModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        <p>Update your account name:</p>
        
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <button class="btn btn-primary spacer" name="submitAdd" type="submit">Update</button>
            
      </div>
    </div>
    
  </div>
</div> 
</div>


<!-- EDIT PASSWORD MODAL -->
<div class="modal fade" id="editPasswordModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        <p>Update your password:</p>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <button class="btn btn-primary spacer" name="submitAdd" type="submit">Update</button>
            
      </div>
    </div>
    
  </div>
</div> 
</div>

<!-- EDIT EMAIL MODAL -->
<div class="modal fade" id="editEmailModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header" style="padding:10px 50px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        
      </div>
      <div class="modal-body" style="padding:15px 50px;">
        <p>Update youremail:</p>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-primary spacer" data-dismiss="modal">Nevermind</button>

          <button class="btn btn-primary spacer" name="submitAdd" type="submit">Update</button>
            
      </div>
    </div>
    
  </div>
</div> 
</div>
 
<script>
$(document).ready(function(){
  $("#removeButton").click(function(){
    $("#removeModal").modal();
  });
});
</script>

<script>
  $(document).ready(function(){
    $(".editButton").click(function(){
      $("#editModal").modal();
    });
  });
  </script>

<script>
  $(document).ready(function(){
    $("#setMainButton").click(function(){
      $("#setMainModal").modal();
    });
  });
  </script>

<script>
  $(document).ready(function(){
    $("#addButton").click(function(){
      $("#addModal").modal();
    });
  });
  </script>

<script>
  $(document).ready(function(){
    $("#editAccountNameButton").click(function(){
      $("#editAccountNameModal").modal();
    });
  });
  </script>

<script>
  $(document).ready(function(){
    $("#editPasswordButton").click(function(){
      $("#editPasswordModal").modal();
    });
  });
  </script>

<script>
  $(document).ready(function(){
    $("#editEmailButton").click(function(){
      $("#editEmailModal").modal();
    });
  });
  </script>
<!-- END REMOVE PLAYER MODAL -->

<script>
  function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
  }
  
  // Get the element with id="defaultOpen" and click on it
  document.getElementById("defaultOpen").click();
  </script>





{% if seasonPlayer %}
<h2 style="color: white">You are currently signed up for Season {{ seasonPlayer.season.id }} as</h2>
{% if seasonPlayer.main_roster %}
<h4 style="color: white">MAIN ROLE</h4>
{% endif %}
{% if seasonPlayer.substitute %}
<h4 style="color: white">SUBSTITUTE</h4>
{% endif %}
{% for seasonPlayerRole in seasonPlayerRoles %} 
<h3 style="color: white">{{ seasonPlayerRole.role.name }}{% if seasonPlayerRole.isMain %} (Main Role){% endif %}</h3>
{% endfor %}
<h2 style="color: white"><a href="/season/{{ season.id }}/sign-up">SIGN UP AGAIN</a></h2>
<h2 style="color: white"><a href="/season/{{ season.id }}/remove-sign-up">DELETE SIGNUP</a></h2>
{% else %}
<h2 style="color: white">You are not signed up for Season {{ season.id }}! <a href="/season/{{ season.id }}/sign-up">SIGN UP</a></h2>
{% endif %}

{% else %}

You don't have a profile when you aren't logged in, silly!

{% endif %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="{% static 'stats/js/profile.js' %}"></script>
{% endblock %}
